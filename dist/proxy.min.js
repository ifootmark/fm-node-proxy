"use strict";var http=require("http"),url=require("url"),querystring=require("querystring"),fmconfig=require("../fm.config.js"),hostName=fmconfig.api_hostName,port=fmconfig.api_port,prefix=fmconfig.proxy_prefix?fmconfig.proxy_prefix+"/":"";exports.proxy=function(e,t){function r(e,r){var n=http.request(e,function(e){return 200!=e.statusCode?void t.status(e.statusCode).end():(e.setEncoding("UTF-8"),void e.on("data",function(e){var r=JSON.parse(e);t.send(r),console.log(r)}))});n.write(querystring.stringify(r)),n.end()}var n=new RegExp(prefix,"gmi"),o=e.path.replace(n,"");if("GET"==e.method){var i={};i=url.parse(e.url,!0).query;var s="?"+querystring.stringify(i),a={hostname:hostName,port:port,path:o+s,method:e.method,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":querystring.stringify(i).length}};r(a,i)}else if("POST"==e.method){e.setEncoding("utf-8");var p="";e.addListener("data",function(e){p+=e}),e.addListener("end",function(){var t=querystring.parse(p),n={hostname:hostName,port:port,path:o,method:e.method,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":querystring.stringify(t).length}};r(n,t)})}};