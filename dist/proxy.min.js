"use strict";var http=require("http"),url=require("url"),querystring=require("querystring"),fmconfig=require("../fm.config.js"),hostName=fmconfig.api_hostName,port=fmconfig.api_port,api_prefix=fmconfig.api_prefix?fmconfig.api_prefix:"",prefix=fmconfig.proxy_prefix?fmconfig.proxy_prefix:"";exports.proxy=function(e,t){function r(e,r){var n=http.request(e,function(e){return 200!=e.statusCode?void t.status(e.statusCode).end():(e.setEncoding("UTF-8"),void e.on("data",function(e){var r=JSON.parse(e);t.send(r),console.log(r)}))});console.log(e),n.write(querystring.stringify(r)),n.end()}var n=new RegExp(prefix,"gmi"),i=e.path.replace(n,api_prefix);if("GET"==e.method){var o={};o=url.parse(e.url,!0).query;var a="?"+querystring.stringify(o),p={hostname:hostName,port:port,path:i+a,method:e.method,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":querystring.stringify(o).length}};r(p,o)}else if("POST"==e.method){e.setEncoding("utf-8");var s="";e.addListener("data",function(e){s+=e}),e.addListener("end",function(){var t=querystring.parse(s),n={hostname:hostName,port:port,path:i,method:e.method,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":querystring.stringify(t).length}};r(n,t)})}};